#include "VLC_transmitter.h"
#include "VLC_timer.h"
#include "VLC_parameters.h"
#include "Vehicle_servo.h"
#include "Vehicle_motor.h"

#include "sdkconfig.h"
#include "freertos/FreeRTOS.h"
#include "freertos/task.h"
#include "freertos/semphr.h"
#include "freertos/message_buffer.h"
#include "rom/ets_sys.h"

#include <string.h>
#include <unistd.h>

/* Testing Messages */
// const char* testing_8bytes_mes = "SCU:No1!";
const char* testing_32bytes_mes = "SCU?No1!no1?vlc!SCU?Win!VLC?Yes!";
const char orignal_128bytes_data[] = {0, 'S', 'C', 'U', 'N', 'O', '1', 'M', 's', 'A', '7', 'y', 'Y', 's', 'l', 'H', 'g', '2', 'f', 'X', 'Y', 'O', '0', 'o', 'o', 'l', 'r', 't', 's', 'Y', 'Q', 'c', 1, '8', 'V', 'e', 'R', 'F', '0', 'J', 'x', 'F', 'E', '8', 'Z', 'w', 'r', 'h', 'k', '4', '7', 'K', 'a', 'J', 'Q', '1', 'Z', 'n', 'R', 'K', 'z', 'm', 'E', 'C', 2, '5', '4', 'P', 'c', 'R', 'o', 'T', 'p', 'm', 'Q', 'W', 'W', 'P', 'o', '1', 'u', 'r', 'z', 'i', 'x', 'Z', 'd', 'v', 'l', 'm', 'Y', 't', 'M', 'n', 'T', 'x', 3, '1', 'm', 'P', 'W', 'w', 'S', 'h', 'S', 'D', '9', 'p', 'J', '2', 'H', 'D', 'G', 'g', 'B', 'j', 'C', '8', 'y', 'e', 'J', 'y', 'q', 'd', '8', 'Q', 'P', 'r', 4, 'U', 'w', 'l', '6'};
const char RS_160_32_encoded_data[]={0, 83, 67, 85, 78, 79, 49, 77, 115, 65, 55, 121, 89, 115, 108, 72, 103, 50, 102, 88, 89, 79, 48, 111, 111, 108, 114, 116, 115, 89, 81, 99, 1, 56, 86, 101, 82, 70, 48, 74, 120, 70, 69, 56, 90, 119, 114, 104, 107, 52, 55, 75, 97, 74, 81, 49, 90, 110, 82, 75, 122, 109, 69, 67, 2, 53, 52, 80, 99, 82, 111, 84, 112, 109, 81, 87, 87, 80, 111, 49, 117, 114, 122, 105, 120, 90, 100, 118, 108, 109, 89, 116, 77, 110, 84, 120, 3, 49, 109, 80, 87, 119, 83, 104, 83, 68, 57, 112, 74, 50, 72, 68, 71, 103, 66, 106, 67, 56, 121, 101, 74, 121, 113, 100, 56, 81, 80, 114, 4, 85, 119, 108, 54, 85, 235, 49, 170, 121, 233, 186, 54, 133, 116, 231, 1, 40, 58, 237, 4, 139, 210, 243, 98, 135, 152, 99, 180, 26, 67, 30, 5, 63, 172, 180, 237, 6};
const char Raptor_encoded_data[]={0, 83, 67, 85, 78, 79, 49, 234, 1, 77, 115, 65, 55, 121, 89, 190, 2, 115, 108, 72, 103, 50, 102, 53, 3, 88, 89, 79, 48, 111, 111, 212, 4, 108, 114, 116, 115, 89, 81, 56, 5, 99, 56, 86, 101, 82, 70, 173, 6, 48, 74, 120, 70, 69, 56, 183, 7, 90, 119, 114, 104, 107, 52, 53, 8, 55, 75, 97, 74, 81, 49, 43, 9, 90, 110, 82, 75, 122, 109, 160, 10, 69, 67, 53, 52, 80, 99, 73, 11, 82, 111, 84, 112, 109, 81, 197, 12, 87, 87, 80, 111, 49, 117, 165, 13, 114, 122, 105, 120, 90, 100, 242, 14, 118, 108, 109, 89, 116, 77, 158, 15, 110, 84, 120, 49, 109, 80, 219, 16, 87, 119, 83, 104, 83, 68, 233, 17, 57, 112, 74, 50, 72, 68, 73, 18, 71, 103, 66, 106, 67, 56, 127, 19, 121, 101, 74, 121, 113, 100, 151, 20, 56, 81, 80, 114, 85, 119, 150, 21, 108, 54, 0, 0, 0, 0, 194, 22, 0, 0, 0, 0, 0, 0, 31, 23, 0, 0, 0, 0, 0, 0, 192, 24, 0, 0, 0, 0, 0, 0, 57, 25, 0, 0, 0, 0, 0, 0, 230, 26, 48, 194, 75, 96, 8, 27, 131, 27, 138, 248, 105, 169, 193, 89, 79, 28, 246, 89, 74, 190, 105, 2, 131, 29, 86, 163, 80, 37, 32, 21, 98, 30, 159, 36, 254, 107, 120, 6, 10, 31, 214, 93, 20, 213, 116, 66, 57};
const char Spinal_encoded_data[]={0, 218, 150, 134, 159, 238, 229, 70, 81, 58, 102, 2, 105, 81, 23, 166, 77, 72, 192, 230, 108, 150, 205, 101, 245, 200, 114, 219, 170, 60, 217, 174, 1, 159, 45, 212, 61, 110, 171, 115, 211, 33, 10, 252, 117, 21, 19, 45, 61, 235, 85, 15, 111, 177, 136, 40, 19, 96, 121, 37, 187, 113, 52, 244, 2, 187, 98, 118, 8, 222, 196, 71, 86, 54, 147, 183, 141, 74, 26, 51, 76, 153, 118, 2, 14, 178, 64, 170, 180, 67, 87, 8, 135, 62, 129, 250, 3, 30, 132, 20, 34, 81, 115, 81, 235, 76, 133, 247, 143, 51, 241, 6, 237, 137, 186, 182, 245, 179, 251, 43, 58, 236, 66, 250, 243, 137, 248, 74, 4, 254, 178, 233, 132, 189, 180, 133, 31, 107, 141, 127, 195, 122, 109, 205, 37, 155, 113, 57, 222, 174, 197, 93, 72, 192, 49, 231, 9, 197, 194, 37, 5, 53, 45, 54, 24, 249, 61, 237, 93, 45, 66, 106, 247, 159, 229, 168, 187, 237, 206, 101, 207, 119, 239, 35, 192, 231, 244, 33, 108, 160, 151, 208, 6, 245, 12, 93, 93, 231, 75, 171, 211, 180, 252, 228, 178, 63, 140, 6, 82, 23, 105, 122, 214, 101, 64, 78, 250, 117, 12, 52, 186, 12, 37, 209, 7, 101, 66, 14, 109, 107, 57, 77, 112, 163, 56, 243, 216, 75, 165, 218, 168, 173, 48, 85, 184, 124, 100, 184, 21, 107, 139, 138, 115, 56, 191, 194, 8, 188, 221, 52, 32, 179, 44, 80, 91, 94, 36, 35, 230, 66, 165, 46, 36, 75, 194, 90, 64, 233, 138, 234, 126, 218, 106, 217, 46, 15, 146, 81, 9, 135, 197, 55, 208, 201, 33, 184, 206, 70, 199, 20, 179, 146, 109, 181, 64, 32, 236, 142, 180, 206, 10, 209, 182, 96, 112, 8, 74, 59, 39, 117, 10, 162, 107, 197, 213, 85, 58, 39, 200, 30, 46, 128, 169, 114, 120, 31, 144, 94, 152, 213, 174, 198, 186, 0, 101, 239, 121, 144, 188, 40, 249, 147, 11, 16, 90, 170, 246, 176, 92, 99, 8, 242, 242, 23, 254, 139, 232, 73, 17, 85, 157, 15, 205, 213, 194, 144, 70, 210, 105, 39, 88, 212, 212, 49, 12, 113, 29, 255, 158, 197, 111, 228, 60, 213, 5, 131, 131, 106, 104, 148, 17, 36, 43, 239, 27, 96, 243, 245, 4, 198, 19, 161, 219, 71, 223, 11, 13, 78, 131, 11, 183, 147, 163, 228, 111, 199, 215, 60, 111, 210, 218, 235, 89, 125, 8, 115, 13, 35, 86, 64, 158, 14};
/* Testing Messages end */

bool isSend = false;

void IRAM_ATTR VLC_timer_generalCallback(gptimer_handle_t timer, void *arg)
{
    isSend = true;
}

void app_main(void)
{
    // const char *mes = "IloveSCUANDIloveSCUMakerANDIloveVLCANDIloveVehicleTalkANDIloveRaptorCodeBUTIhateSpinalCodeBeacuseIt'suselessANDIloveMath:0123456789Somethinglikethat";
    VLC_transmitter_init();
    Vehicle_motor_init();
    Vehicle_Lmotor_stop();
    Vehicle_Rmotor_stop();
    Vehicle_servo_init();

    printf("TX start\n");
    TransmitterFlag tx_pin = VLC_TX2;
    VLC_timer_general_init(1500000,true);
    int test_temp_state = 0;

    while (1)
    {

        VLC_transmitter_DoSend(testing_32bytes_mes,tx_pin,strlen(testing_32bytes_mes));

        // VLC_transmitter_DoSend(RS_160_32_encoded_data,tx_pin,sizeof(RS_160_32_encoded_data));
        // VLC_transmitter_DoSend(RS_160_32_orignal_data,tx_pin,sizeof(RS_160_32_orignal_data));

        // VLC_transmitter_DoSend(Raptor_encoded_data,tx_pin,sizeof(Raptor_encoded_data));

        // VLC_transmitter_DoSend(Spinal_encoded_data,tx_pin,sizeof(Spinal_encoded_data));


    }
}
